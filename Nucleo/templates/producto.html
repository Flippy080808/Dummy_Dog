{% extends 'base.html' %}
{% load static %}

{% block title %}{{ producto.nombre }} - Dummy Dog{% endblock %}

{% block styles %}
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #f9f9f9; }
    .breadcrumb-nav { display:flex; align-items:center; gap:8px; margin-bottom:30px; padding:16px 0; font-size:14px; }
    .breadcrumb-nav a { color: var(--blue); text-decoration:none; font-weight:500; transition: color 0.2s; }
    .product-hero { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 40px; }
    .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 48px; padding: 48px; align-items: start; }
    .product-image { border-radius: 12px; overflow: hidden; background: linear-gradient(135deg, var(--light-green) 0%, #f0f8f0 100%); display:flex; align-items:center; justify-content:center; aspect-ratio:1; }
    .product-image img { width: 100%; height: 100%; object-fit: contain; padding: 20px; }
    .product-info h1 { font-size: 36px; font-weight: 700; color: var(--gray-dark); margin-bottom: 16px; line-height: 1.2; }
    .category-badge { display:inline-block; background:var(--yellow); color:var(--gray-dark); padding:6px 16px; border-radius:20px; font-size:12px; font-weight:600; margin-bottom:20px; text-transform:uppercase; }
    .brand-info { color: var(--text-muted); font-size:14px; margin-bottom:20px; display:flex; align-items:center; gap:8px; }
    .price-section { background: linear-gradient(135deg, var(--light-green) 0%, #f0f8f0 100%); padding:28px; border-radius:12px; border-left:5px solid var(--primary-green); margin-bottom:28px; }
    .price-value { font-size:48px; font-weight:700; color:var(--primary-green); margin-bottom:8px; }
    .stock-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:32px; }
    .stock-box { background:white; padding:20px; border-radius:12px; border:2px solid var(--gray); text-align:center; }
    .action-buttons { display:flex; gap:12px; margin-bottom:20px; }
    .btn-cart { flex:1; padding:14px 20px; font-size:15px; font-weight:600; border-radius:8px; color:white; background:var(--blue); border:none; }
    .btn-checkout { flex:1; padding:14px 20px; font-size:15px; font-weight:600; border-radius:8px; color:white; background:var(--primary-green); display:flex; align-items:center; justify-content:center; text-decoration:none }
    .btn-continue { width:100%; padding:12px; border:2px solid var(--blue); background:white; color:var(--blue); border-radius:8px; font-weight:600; text-align:center; display:block; text-decoration:none }
    .notification { position: fixed; top: 20px; right: 20px; background: var(--primary-green); color: white; padding: 16px 24px; border-radius:8px; box-shadow: 0 4px 12px rgba(76,230,76,0.3); z-index:1000; }
    @media (max-width: 992px) { .product-grid { grid-template-columns:1fr; gap:32px; padding:32px; } .product-image { min-height:300px } }
    @media (max-width:576px) { .product-grid { padding:20px } }
</style>
{% endblock %}

{% block content %}
    {% if producto %}
    <div class="container" style="max-width:1200px;margin:40px auto;padding:0 16px;">
        <div class="breadcrumb-nav">
            <a href="/">üè† Inicio</a>
            <span style="color:var(--text-muted);">‚Ä∫</span>
            <a href="{% url 'productos_list' %}">üì¶ Cat√°logo</a>
            <span style="color:var(--text-muted);">‚Ä∫</span>
            <span style="color:var(--gray-dark);font-weight:600;">{{ producto.nombre|truncatewords:3 }}</span>
        </div>

        <div class="product-hero">
            <div class="product-grid">
                <div class="product-image">
                    {% if producto.imagen_url %}
                    <img src="{{ producto.imagen_url }}" alt="{{ producto.nombre }}" onerror="this.src='https://previews.123rf.com/images/keltmd/keltmd1709/keltmd170900112/85061079-dead-face-icon-in-outline-style-vector-illustration-for-design-and-web-isolated-on-white-background.jpg'">
                    {% else %}
                    <img src="https://previews.123rf.com/images/keltmd/keltmd1709/keltmd170900112/85061079-dead-face-icon-in-outline-style-vector-illustration-for-design-and-web-isolated-on-white-background.jpg" alt="{{ producto.nombre }}">
                    {% endif %}
                </div>

                <div class="product-info">
                    {% if producto.categoria %}<span class="category-badge">{{ producto.categoria }}</span>{% endif %}
                    <h1>{{ producto.nombre }}</h1>
                    {% if producto.marca %}<div class="brand-info"><span>üè∑Ô∏è</span><strong>{{ producto.marca }}</strong></div>{% endif %}

                    <div class="price-section">
                        <div class="price-label">Precio</div>
                        <div class="price-value">${{ producto.precio }}</div>
                        <div class="price-note">‚úì IVA incluido</div>
                    </div>

                    <div class="stock-grid">
                        <div class="stock-box"><div class="stock-label">üì¶ Disponible</div><div class="stock-value">{{ producto.inventario }}</div><div class="stock-unit">en stock</div></div>
                        <div class="stock-box"><div class="stock-label">üè• Veterinaria</div><div class="stock-value" style="color:var(--blue);">{{ producto.id_veter|default:"‚Äî" }}</div><div class="stock-unit">ID</div></div>
                    </div>

                    <div class="action-buttons">
                        <button onclick="addToCart()" class="btn-cart">üõí Agregar al carrito</button>
                        <a href="/carrito" class="btn-checkout">‚úÖ Ir al carrito</a>
                    </div>

                    <a href="/" class="btn-continue">‚Üê Seguir comprando</a>
                </div>
            </div>
        </div>
    </div>

    <div style="background:white;margin-top:60px;padding:60px 0;">
        <div class="container" style="max-width:1200px;">
            <h2 style="font-size:28px;font-weight:700;margin-bottom:40px;text-align:center;color:var(--gray-dark);">‚ú® Productos Relacionados</h2>
            <div class="row g-4">
                {% for prod in productos_relacionados %}
                <div class="col-6 col-md-4 col-lg-3">
                    <a href="{% url 'producto_by_pk' prod.pk %}" style="text-decoration:none;color:inherit;">
                        <div style="background:white;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.06);transition:all 0.2s;border:2px solid transparent;">
                            <div style="height:200px;background:var(--gray-light);overflow:hidden;display:flex;align-items:center;justify-content:center;">
                                {% if prod.imagen_url %}
                                <img src="{{ prod.imagen_url }}" style="width:100%;height:100%;object-fit:contain;padding:10px;" onerror="this.src='https://previews.123rf.com/images/keltmd/keltmd1709/keltmd170900112/85061079-dead-face-icon-in-outline-style-vector-illustration-for-design-and-web-isolated-on-white-background.jpg'">
                                {% else %}
                                <img src="https://previews.123rf.com/images/keltmd/keltmd1709/keltmd170900112/85061079-dead-face-icon-in-outline-style-vector-illustration-for-design-and-web-isolated-on-white-background.jpg" style="width:100%;height:100%;object-fit:contain;padding:10px;">
                                {% endif %}
                            </div>
                            <div style="padding:16px;">
                                <h6 style="font-weight:600;font-size:14px;margin-bottom:8px;color:var(--gray-dark);">{{ prod.nombre|truncatewords:4 }}</h6>
                                <p style="color:var(--primary-green);font-weight:700;font-size:18px;margin:8px 0;">${{ prod.precio }}</p>
                                <button style="width:100%;padding:8px;background:var(--blue);color:white;border:none;border-radius:6px;font-weight:600;font-size:12px;cursor:pointer;transition:all 0.2s;">Ver detalles ‚Üí</button>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="container mt-5" style="max-width:600px;">
        <div style="background:white;padding:40px;border-radius:12px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.08);">
            <h3 style="font-size:28px;color:var(--gray-dark);margin-bottom:12px;">‚ö†Ô∏è Producto no encontrado</h3>
            <p style="color:var(--text-muted);margin-bottom:24px;">El producto que buscas no existe o ha sido eliminado.</p>
            <a href="{% url 'productos_list' %}" style="display:inline-block;background:var(--blue);color:white;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:600;transition:all 0.2s;">‚Üê Volver al cat√°logo</a>
        </div>
    </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<script>
    const CART_KEY = 'dummy_dog_cart';

    function addToCart() {
        const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
        const product = {
            nombre: '{{ producto.nombre|escapejs }}',
            marca: '{{ producto.marca|default:""|escapejs }}',
            precio: '{{ producto.precio }}',
            imagen_url: '{{ producto.imagen_url|default:""|escapejs }}',
            quantity: 1
        };

        // Use nombre+marca+precio as a simple key if id not available
        const key = product.nombre + '|' + product.marca + '|' + product.precio;
        const existingItem = cart.find(item => (item._key === key));
        if (existingItem) {
            existingItem.quantity = (existingItem.quantity || 1) + 1;
        } else {
            product._key = key;
            cart.push(product);
        }

        localStorage.setItem(CART_KEY, JSON.stringify(cart));
        updateNavbarCart();
        showNotification();
    }

    function updateNavbarCart() {
        const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
        const count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        const cartBtn = document.getElementById('navbar-cart') || document.querySelector('a[href="/carrito"]');
        if (cartBtn) {
            cartBtn.textContent = count > 0 ? `üõí Carrito (${count})` : 'üõí Carrito';
        }
    }

    function showNotification() {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = '‚úÖ ¬°Agregado al carrito!';
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 2200);
    }

    document.addEventListener('DOMContentLoaded', updateNavbarCart);
    window.addEventListener('storage', updateNavbarCart);
</script>
<style>
    @keyframes slideOut { to { transform: translateX(400px); opacity: 0; } }
</style>
{% endblock %}

    <footer style="background:#2a2a2a;color:white;text-align:center;padding:40px 20px;margin-top:60px;">
        <div class="container" style="max-width:1200px;">
            <p style="margin:0;font-size:14px;color:#aaa;">&copy; 2025 Dummy Dog. Todos los derechos reservados. üêæ</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const CART_KEY = 'dummy_dog_cart';

        function addToCart() {
            const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
            const product = {
                //id_product: {{ producto.id_product }},
                nombre: '{{ producto.nombre }}',
                marca: '{{ producto.marca }}',
                precio: '{{ producto.precio }}',
                imagen_url: '{{ producto.imagen_url }}',
                cantidad: 1
            };

            const existingItem = cart.find(item => item.id_product === product.id_product);
            if (existingItem) {
                existingItem.quantity = (existingItem.quantity || 1) + 1;
            } else {
                product.quantity = 1;
                cart.push(product);
            }

            localStorage.setItem(CART_KEY, JSON.stringify(cart));
            updateNavbarCart();
            showNotification();
        }

        function updateNavbarCart() {
            const cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
            const count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            const cartBtn = document.querySelector('a[href="/carrito"]');
            if (cartBtn) {
                cartBtn.textContent = count > 0 ? `üõí Carrito (${count})` : 'üõí Carrito';
            }
        }

        function showNotification() {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = '‚úÖ ¬°Agregado al carrito!';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2500);
        }

        document.addEventListener('DOMContentLoaded', updateNavbarCart);
        window.addEventListener('storage', updateNavbarCart);
    </script>
    <style>
        @keyframes slideOut {
            to { transform: translateX(400px); opacity: 0; }
        }
    </style>
</body>

</html>