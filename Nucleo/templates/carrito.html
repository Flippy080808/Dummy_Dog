{% extends 'base.html' %}
{% load static %}

{% block title %}üõí Carrito - Dummy Dog{% endblock %}

{% block styles %}
<style>
    .cart-item { display: grid; grid-template-columns: 80px 1fr 100px 50px; gap:16px; align-items:center; padding:16px; background:white; border-radius:10px; border:1px solid var(--gray); margin-bottom:12px; }
    .cart-item-image { width:80px; height:80px; background:var(--gray-light); border-radius:8px; overflow:hidden }
    .cart-item-image img{ width:100%; height:100%; object-fit:cover }
    .cart-item-info h6{ font-weight:600; margin-bottom:6px; font-size:14px }
    .cart-item-price{ font-weight:700; color:var(--primary-green); font-size:16px }
    .quantity-control{ display:flex; align-items:center; gap:8px; background:var(--gray-light); padding:4px 8px; border-radius:6px }
    .btn-remove{ background:#ffcdd2; color:#c62828; border:none; border-radius:6px; padding:6px 12px; font-weight:600 }
    .summary-box{ background: linear-gradient(135deg, var(--light-green) 0%, #f0f8f0 100%); padding:24px; border-radius:12px; border-left:4px solid var(--primary-green) }
    .summary-row{ display:flex; justify-content:space-between; margin-bottom:12px }
    .summary-row.total{ border-top:2px solid var(--primary-green); padding-top:12px; font-size:18px; font-weight:700; color:var(--primary-green) }
    .empty-cart{ text-align:center; padding:80px 20px }
    @media (max-width:768px) {.cart-item{ grid-template-columns:60px 1fr 30px }}
</style>
{% endblock %}

{% block content %}
    <div class="container mt-5" style="max-width:1200px;">
        <h1 style="font-weight:700;margin-bottom:30px;">üõí Mi Carrito de Compras</h1>

        <div class="row">
            <div class="col-lg-8">
                <div id="cart-items-container"></div>
            </div>
            <div class="col-lg-4">
                <div class="summary-box">
                    <h5 style="margin-bottom:20px;font-weight:700;">Resumen del Pedido</h5>
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0</span>
                    </div>
                    <div class="summary-row">
                        <span>IVA (19%):</span>
                        <span id="iva">$0</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">$0</span>
                    </div>
                    <button class="btn btn-success w-100 mt-3" style="padding:12px;font-weight:600;font-size:15px;">‚úÖ Proceder al pago</button>
                    <a href="/" class="btn btn-secondary w-100 mt-2" style="padding:12px;font-weight:600;">‚Üê Continuar comprando</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    const CART_KEY = 'dummy_dog_cart';

    function getCart() { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
    function saveCart(cart) { localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCart(); updateNavbarCart(); }

    function renderCart() {
        const cart = getCart();
        const container = document.getElementById('cart-items-container');
        if (!container) return;
        if (cart.length === 0) {
            container.innerHTML = `
                <div class="empty-cart">
                    <div class="empty-cart-icon">üõí</div>
                    <h3>Tu carrito est√° vac√≠o</h3>
                    <p style="color:var(--text-muted);margin:16px 0;">Agrega algunos productos para comenzar</p>
                    <a href="/" class="btn btn-primary mt-3">Ir a productos</a>
                </div>
            `; return;
        }

        container.innerHTML = cart.map((item, idx) => `
            <div class="cart-item">
                <div class="cart-item-image"><img src="${item.imagen_url || 'https://previews.123rf.com/images/keltmd/keltmd1709/keltmd170900112/85061079-dead-face-icon-in-outline-style-vector-illustration-for-design-and-web-isolated-on-white-background.jpg'}" alt="${item.nombre}" onerror="this.src='https://previews.123rf.com/images/keltmd/keltmd1709/keltmd170900112/85061079-dead-face-icon-in-outline-style-vector-illustration-for-design-and-web-isolated-on-white-background.jpg'"></div>
                <div class="cart-item-info"><h6>${item.nombre}</h6><div class="cart-item-price">$${parseFloat(item.precio).toFixed(2)}</div></div>
                <div class="quantity-control"><button onclick="updateQuantity(${idx}, -1)">‚àí</button><span style="min-width:25px;text-align:center;">${item.quantity}</span><button onclick="updateQuantity(${idx}, 1)">+</button></div>
                <button class="btn-remove" onclick="removeFromCart(${idx})">‚ùå</button>
            </div>
        `).join('');
        updateTotals();
    }

    function updateQuantity(idx, change) { const cart = getCart(); cart[idx].quantity += change; if (cart[idx].quantity < 1) cart.splice(idx,1); saveCart(cart); }
    function removeFromCart(idx) { const cart = getCart(); cart.splice(idx,1); saveCart(cart); }
    function updateTotals() { const cart = getCart(); const subtotal = cart.reduce((sum,item)=> sum + (parseFloat(item.precio)*item.quantity),0); const iva = subtotal*0.19; const total = subtotal + iva; document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2); document.getElementById('iva').textContent = '$' + iva.toFixed(2); document.getElementById('total').textContent = '$' + total.toFixed(2); }

    function updateNavbarCart() { const cart = getCart(); const count = cart.reduce((sum,item)=> sum + (item.quantity||0),0); const cartBtn = document.getElementById('navbar-cart') || document.querySelector('a[href="/carrito"]'); if (cartBtn) cartBtn.textContent = count>0?`üõí Carrito (${count})`:'üõí Carrito'; }

    document.addEventListener('DOMContentLoaded', ()=>{ renderCart(); updateNavbarCart(); });
</script>
{% endblock %}

