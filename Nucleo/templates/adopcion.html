<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adopci贸n de Mascotas - Dummy Dog</title>
    <!-- Carga de Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Carga de Google Font (Inter) para una tipograf铆a moderna -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Definici贸n de variables de color inspiradas en el dise帽o */
        :root {
            --primary-green: #48BB78; /* Verde brillante */
            --dark-green: #38A169; /* Verde oscuro para contrastes y navbar */
            --accent-yellow: #FBD38D; /* Amarillo/Naranja para botones */
            --light-bg: #EDF7F6; /* Fondo claro para el cuerpo */
            --text-dark: #2D3748; /* Texto oscuro */
        }

        body { 
            padding-top: 70px; 
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
        }
        
        /* Estilos de la barra de navegaci贸n */
        .navbar-custom { 
            background: var(--dark-green) !important; 
            font-weight: 600;
        }
        .navbar-brand, .nav-link {
            color: #fff !important;
        }
        .nav-link:hover {
            color: var(--accent-yellow) !important;
        }

        /* Estilos de la secci贸n Hero */
        .hero-section {
            background: linear-gradient(145deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 60px 0 90px;
            margin-bottom: 0; /* Lo gestionaremos con el contenedor */
            border-bottom-left-radius: 50% 5%; /* Curva sutil en el fondo */
            border-bottom-right-radius: 50% 5%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        .hero-section h1 {
            font-size: 2.5rem;
            font-weight: 800;
        }
        .hero-section p {
            font-size: 1.15rem;
            opacity: 0.9;
        }

        /* Contenedor principal para superponer contenido */
        .main-content {
            margin-top: -50px; /* Superponer ligeramente sobre el hero */
            position: relative;
            z-index: 10;
        }

        /* Estilo para los botones de cambio de vista (como tabs modernos) */
        .adopt-actions-switch {
            display: inline-flex;
            background-color: white;
            padding: 5px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .adopt-btn {
            border: none;
            padding: 10px 25px;
            font-weight: 700;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .adopt-btn:not(.active) {
            background-color: transparent;
            color: var(--text-dark);
        }
        .adopt-btn.active {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
        }
        /* Estilo para el bot贸n Disponible (activo) */
        .adopt-btn.disponible.active {
            background-color: var(--dark-green);
            color: white;
        }
        /* Estilo para el bot贸n Dar en adopci贸n (activo) */
        .adopt-btn.dar.active {
            background-color: var(--accent-yellow);
            color: var(--text-dark);
        }

        /* Estilos de la tarjeta de mascota (Pet Card) */
        .pet-card {
            background-color: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .pet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .pet-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .pet-details {
            padding: 1.25rem;
        }

        /* Estilos del formulario */
        .give-form {
            background-color: white;
            padding: 30px;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .give-form label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        .give-form .form-control, .give-form .form-select {
            border-radius: 0.5rem;
            border-color: #ced4da;
        }

        /* Estilo para el bot贸n final de env铆o del formulario */
        .btn-submit-form {
            background-color: var(--primary-green);
            border-color: var(--dark-green);
            color: white;
            font-weight: 700;
            padding: 12px 30px;
            border-radius: 0.75rem;
            transition: background-color 0.3s;
        }
        .btn-submit-form:hover {
            background-color: var(--dark-green);
            color: white;
        }

        /* Utilidades para los iconos de FontAwesome (simulando los iconos que suelen usar estos dise帽os) */
        .icon-pet::before {
            content: "";
            margin-right: 0.5rem;
        }
        .icon-user::before {
            content: "";
            margin-right: 0.5rem;
        }
    </style>
</head>

<body>
    {% comment %} Navbar adaptado a rutas Django existentes {% endcomment %}
    <nav class="navbar navbar-expand-lg navbar-custom shadow-sm fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <span style="font-size: 1.25rem; margin-right: 5px;"></span> Dummy Dog
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/Veterinaria">Veterinaria</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/servicios">Servicios</a>
                    </li>
                    <!-- Bot贸n + Agregar (destacado en amarillo) -->
                    <li class="nav-item ms-md-3">
                        <a class="nav-link px-3 py-1.5 rounded-pill" href="{% url 'agregar_producto' %}" style="background:var(--accent-yellow);color:var(--text-dark) !important;font-weight:700; margin-top: 3px;">
                            <span style="font-size: 1.2em;">+</span> Agregar
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section (Gradiente Verde) -->
    <div class="hero-section text-center">
        <div class="container">
            <h1 class="display-5 mb-2">驴Est谩s buscando un compa帽ero?</h1>
            <p class="lead">Dale una segunda oportunidad a un peludo: adopta o publica su ficha para encontrarle un hogar.</p>
        </div>
    </div>

    <!-- Contenedor Principal (main-content) -->
    <div class="container py-5 main-content">
        <!-- Bloque de Botones de Acci贸n (Switch) Centrado -->
        <div class="d-flex justify-content-center mb-5">
            <div class="adopt-actions-switch">
                <button id="btn-disponible" class="adopt-btn disponible active">
                    <span class="icon-pet"></span> Mascotas Disponibles
                </button>
                <button id="btn-dar" class="adopt-btn dar">
                    <span class="icon-user"></span> Dar en Adopci贸n
                </button>
            </div>
        </div>

        <!-- Contenedor din谩mico: disponible / dar en adopci贸n -->
        <div id="adopt-root">
            <!-- Disponible view -->
            <div id="view-disponible">
                <h3 class="fw-bold text-center mb-4" style="color:var(--text-dark);">Mascotas disponibles</h3>
                
                <div id="available-list" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    <!-- tarjetas renderizadas por JS -->
                </div>
            </div>

            <!-- Dar en adopci贸n view (form) -->
            <div id="view-dar" style="display:none;">
                <h3 class="fw-bold text-center mb-4" style="color:var(--dark-green);">Publica una ficha y cambia una vida</h3>
                
                <div class="give-form mx-auto" style="max-width: 800px;">
                    <form id="adopt-form">
                        
                        <h5 class="mb-3 fw-bold" style="color:var(--text-dark);">Datos del Cachorro</h5>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="pet-name">Nombre del cachorro <span class="text-danger">*</span></label>
                                <input type="text" id="pet-name" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label for="pet-breed">Raza</label>
                                <input type="text" id="pet-breed" class="form-control" placeholder="Ej: Mestizo, Labrador">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="pet-sex">Sexo <span class="text-danger">*</span></label>
                                <select id="pet-sex" class="form-select" required>
                                    <option value="">-- Seleccione --</option>
                                    <option value="Macho">Macho</option>
                                    <option value="Hembra">Hembra</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="pet-age">Edad</label>
                                <input type="text" id="pet-age" class="form-control" placeholder="Ej: 6 meses, 2 a帽os">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="pet-image">URL de la foto (隆Una buena foto ayuda mucho!)</label>
                            <input type="url" id="pet-image" class="form-control" placeholder="https://...">
                        </div>
                        
                        <div class="mb-4">
                            <label for="pet-desc">Descripci贸n (Personalidad, salud, etc.)</label>
                            <textarea id="pet-desc" class="form-control" rows="3" placeholder="Breve descripci贸n del car谩cter y estado de salud..."></textarea>
                        </div>

                        <h5 class="mb-3 fw-bold" style="color:var(--text-dark);">Datos del Cuidador</h5>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="caretaker-name">Encargado <span class="text-danger">*</span></label>
                                <input type="text" id="caretaker-name" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label for="caretaker-phone">Tel茅fono <span class="text-danger">*</span></label>
                                <input type="text" id="caretaker-phone" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="caretaker-location">Ubicaci贸n (Ciudad/Sector)</label>
                                <input type="text" id="caretaker-location" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label for="caretaker-reason">Motivo de la Adopci贸n</label>
                                <input type="text" id="caretaker-reason" class="form-control" placeholder="Ej: Mudanza, falta de tiempo">
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-submit-form">
                                PUBLICAR FICHA DE ADOPCIN
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer Sencillo -->
    <footer class="bg-dark text-white text-center p-3 mt-5">
        <p class="mb-0 text-sm">漏 2025 Dummy Dog. Un proyecto para fomentar la adopci贸n.</p>
    </footer>

    <!-- Scripts de Bootstrap y L贸gica -->
    <script>
        // Funci贸n auxiliar para generar tarjetas de prueba si no hay datos.
        function getMockPets() {
            return [
                { name: "Max", breed: "Pastor Alem谩n", sex: "Macho", age: "1 a帽o", image: "https://placehold.co/400x200/48BB78/ffffff?text=Max+el+Juguet贸n", desc: "Muy juguet贸n, protector y necesita mucho espacio para correr. Ideal para una familia activa.", caretaker: "Ana P.", phone: "555-1234", location: "Santiago", reason: "Me mudo al extranjero" },
                { name: "Luna", breed: "Mestiza", sex: "Hembra", age: "6 meses", image: "https://placehold.co/400x200/FBD38D/2D3748?text=Luna+la+Tranquila", desc: "Una cachorrita muy dulce y tranquila. Lista para su primera familia y convive bien con ni帽os.", caretaker: "Javier M.", phone: "555-5678", location: "Valpara铆so", reason: "Rescatada de la calle" },
                { name: "Coco", breed: "Beagle", sex: "Macho", age: "3 a帽os", image: "https://placehold.co/400x200/38A169/ffffff?text=Coco+el+Comel贸n", desc: "Amante de la comida y de los paseos. Un poco ladrador, pero muy cari帽oso.", caretaker: "Teresa R.", phone: "555-9012", location: "Concepci贸n", reason: "Tengo alergia" }
            ];
        }

        const STORAGE_KEY = 'adopcion_pets';

        function getPets(){
            try{
                const stored = localStorage.getItem(STORAGE_KEY);
                if (!stored || JSON.parse(stored).length === 0) {
                    savePets(getMockPets()); // Inicializar con datos de prueba
                    return getMockPets();
                }
                return JSON.parse(stored) || [];
            }catch(e){
                console.error("Error al obtener mascotas de localStorage:", e);
                return getMockPets(); // Fallback a mock si hay error
            }
        }

        function savePets(pets){
            localStorage.setItem(STORAGE_KEY, JSON.stringify(pets));
        }

        function createPetCard(p) {
            const defaultImage = 'https://placehold.co/400x200/718096/E6FFFA?text=No+Foto';
            const img = p.image && p.image.startsWith('http') ? p.image : defaultImage;
            
            return `
                <div class="col">
                    <div class="pet-card">
                        <img src="${img}" class="card-img-top" alt="Foto de ${p.name}" 
                             onerror="this.onerror=null; this.src='${defaultImage}';"
                             loading="lazy">
                        <div class="pet-details">
                            <h5 class="fw-bold mb-1" style="color:var(--text-dark);">${p.name || 'Sin Nombre'}</h5>
                            <small class="text-muted">${p.breed || 'Mestizo'} | ${p.age || 'Edad no definida'}</small>
                            <div class="mt-2" style="font-size: 0.9rem;">
                                <div><strong>Sexo:</strong> ${p.sex || '-'}</div>
                                <div><strong>Ubicaci贸n:</strong> ${p.location || 'No especificada'}</div>
                            </div>
                            <p class="text-secondary mt-3 mb-3 small">${(p.desc||'').substring(0, 100) + ((p.desc||'').length > 100 ? '...' : '') || 'Sin descripci贸n.'}</p>
                            <button class="btn btn-sm btn-dark w-100" style="background-color:var(--dark-green); border-color:var(--dark-green);">
                                隆Quiero Adoptar!
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAvailable(){
            const list = document.getElementById('available-list');
            const pets = getPets();
            
            if(pets.length === 0){
                list.innerHTML = '<div class="col-12"><div class="text-center p-5 bg-white rounded-3 shadow-sm text-secondary">隆Vaya! Parece que no hay mascotas disponibles en este momento.</div></div>';
                return;
            }
            
            list.innerHTML = pets.map(createPetCard).join('');
        }

        function showDisponible(){
            document.getElementById('view-disponible').style.display = 'block';
            document.getElementById('view-dar').style.display = 'none';
            document.getElementById('btn-disponible').classList.add('active');
            document.getElementById('btn-dar').classList.remove('active');
            renderAvailable();
        }

        function showDar(){
            document.getElementById('view-disponible').style.display = 'none';
            document.getElementById('view-dar').style.display = 'block';
            document.getElementById('btn-disponible').classList.remove('active');
            document.getElementById('btn-dar').classList.add('active');
            // Mover la vista hacia arriba para centrar la atenci贸n en el formulario
            window.scrollTo({ top: 150, behavior: 'smooth' });
            // Enfocar el primer input
            setTimeout(()=>{
                const f=document.getElementById('pet-name'); 
                if(f) f.focus();
            }, 100);
        }

        document.addEventListener('DOMContentLoaded', ()=>{
            document.getElementById('btn-disponible').addEventListener('click', showDisponible);
            document.getElementById('btn-dar').addEventListener('click', showDar);
            
            document.getElementById('adopt-form').addEventListener('submit', (e)=>{
                e.preventDefault();
                
                const form = e.target;
                const pet = {
                    name: form.querySelector('#pet-name').value.trim(),
                    breed: form.querySelector('#pet-breed').value.trim(),
                    sex: form.querySelector('#pet-sex').value,
                    age: form.querySelector('#pet-age').value.trim(),
                    image: form.querySelector('#pet-image').value.trim(),
                    desc: form.querySelector('#pet-desc').value.trim(),
                    caretaker: form.querySelector('#caretaker-name').value.trim(),
                    phone: form.querySelector('#caretaker-phone').value.trim(),
                    location: form.querySelector('#caretaker-location').value.trim(),
                    reason: form.querySelector('#caretaker-reason').value.trim(),
                    created_at: new Date().toISOString()
                };
                
                if (!pet.name || !pet.sex || !pet.caretaker || !pet.phone) {
                    // En un entorno real, mostrar un mensaje de error modal
                    console.error("Faltan campos requeridos.");
                    alert('Por favor, completa los campos obligatorios marcados con *');
                    return;
                }

                const pets = getPets();
                pets.unshift(pet);
                savePets(pets);
                
                console.log(`Mascota ${pet.name} publicada con 茅xito.`);

                // Mostrar disponibles con nueva ficha y mensaje de 茅xito (simulado)
                form.reset();
                showDisponible();
                alert('隆Ficha de adopci贸n publicada con 茅xito! Ya puedes verla en la lista de disponibles.');
            });

            // Inicializar vista disponible
            showDisponible();
        });
    </script>
    <!-- Carga del Bundle de Bootstrap 5.3 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
